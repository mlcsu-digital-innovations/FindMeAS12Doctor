<app-navbar></app-navbar>
<div class="page-content">
  <div class="row">
    <div class="col-md-12">
      <div class="card">
        <div class="card-header">
          <div class="card-icon">
            <i class="fas fa-search fa-4x"></i>
          </div>
          <div class="card-header-text">
            <h4 class="card-title">Select Doctor</h4>
            <h6 class="card-subtitle mb-2 text-muted">
              Additional explanation text can be added here if required
            </h6>
          </div>
        </div>

        <div class="card-body" *ngIf="assessment$ | async as assessment; else loading">

          <div class="assessment-details">

            <div class="row">
              <div class="col-md-3 label">
                Assessment To be Completed By:
              </div>
              <div class="col-md-4">
                {{assessment.dateTime | date:'medium'}}
              </div>
              <div class="col-md-2 label">
                Assessment Postcode:
              </div>
              <div class="col-md-3">
                {{assessment.postcode}}
              </div>
            </div>

            <div class="row">
              <div class="col-md-3 label">
                Patient Identifier:
              </div>
              <div class="col-md-4">
                {{assessment.patientIdentifier}}
              </div>
              <div class="col-md-2 label">
                Speciality:
              </div>
              <div class="col-md-3">
                {{assessment.specialityName === null ? 'None' : assessment.specialityName}}
              </div>
            </div>

            <div class="row">
              <div class="col-md-3 label">
                Lead AMHP:
              </div>
              <div class="col-md-4">
                Martin Price
              </div>
              <div class="col-md-2 label">
                Preferred Doctor Gender:
              </div>
              <div class="col-md-3">
                {{assessment.preferredDoctorGenderTypeName === null ? 'N/A' : assessment.preferredDoctorGenderTypeName}}
              </div>
            </div>

            <div class="row">
              <div class="col-md-3 label">
                Doctors Allocated:
              </div>
              <div class="col-md-4">
                <span>Dr John Jones</span>
                <span>Dr Elizabeth Fielding</span>
              </div>
            </div>
          </div>


          <form [formGroup]="doctorForm" novalidate>
            <!-- Search Doctor -->
            <div class="form-row" style="margin-left:6px;">
              <div class="col-md-4 mb-2">
                <label for="searchDoctor">Search Doctor</label>
                <input
                  type="text"
                  class="form-control"
                  id="searchDoctor"
                  #searchDoctor
                  [class.is-invalid]="hasDoctorSearchFailed"
                  formControlName="searchDoctor"
                  [ngbTypeahead]="DoctorSearch"
                  [resultFormatter]="FormatTypeAheadResults"
                  [inputFormatter]="FormatTypeAheadResults"
                />
              </div>
              <div class="col-md-1 mb-2 text-left mt-more-4">
                <button
                  type="button"
                  class="btn btn-primary"
                  ngbTooltip="Select this doctor"
                  placement="top"
                  tooltipClass="subtle-tooltip"
                  [closeDelay]="500"
                  [openDelay]="1000"
                >
                  <i class="far fa-check-circle"></i>
                  Confirm
                </button>
              </div>
              <div class="col-md-3 mb-2 text-left mt-more-4">
                <button
                  type="button"
                  class="btn btn-primary"
                  ngbTooltip="Add doctor not registered with FMAS12D"
                  placement="top"
                  tooltipClass="subtle-tooltip"
                  [closeDelay]="500"
                  [openDelay]="1000"
                >
                  <i class="fas fa-user-plus"></i>
                  Additional Doctor
                </button>
              </div>
              <div class="col-md-3 mb-2 ">
              <label for="selectDistance">Search Doctors within:</label>
                <select
                  class="browser-default custom-select"
                  formControlName="doctorDistance"
                  #doctorDistance
                  id="doctorDistance"
                >
                  <option selected id="selectDistance">Select distance from patient</option>
                  <option value="1">1 Mile</option>
                  <option value="5">5 Miles</option>
                  <option value="10">10 Miles</option>
                  <option value="100">More than 10 Miles</option>
                </select>
              </div>
            </div>
            <!-- Search Doctor Errors -->
            <div class="form-row">
              <div class="col-md-8 mb-2">
                <span *ngIf="isDoctorSearching">searching...</span>
                <div class="invalid-field" *ngIf="hasDoctorSearchFailed">
                  Sorry, suggestions could not be loaded.
                </div>
              </div>
            </div>

            <app-delay-spinner [delayMessage]="'Retrieving Available Doctors'" *ngIf="isAvailableDoctorSearching"></app-delay-spinner>

            <div class="form-row" style="margin:10px; padding-top:10px; overflow: auto;">
              <table class="table table-bordered table-sm table-referral-list">
                <thead>
                  <tr>
                    <th class="text-center" scope="col" sortable="doctorName" (sort)="OnSort($event)">
                      Doctor
                    </th>
                    <th class="text-center" scope="col" sortable="doctorGender" (sort)="OnSort($event)">
                      Gender
                    </th>
                    <th class="text-center" scope="col" sortable="doctorType" (sort)="OnSort($event)">
                      Doctor Type
                    </th>
                    <th class="text-center" scope="col" sortable="doctorSpeciality" (sort)="OnSort($event)">
                      Speciality
                    </th>
                    <th class="text-center sm-col" scope="col" sortable="otherAssessmentDetails" (sort)="OnSort($event)">
                      Scheduled Assessment
                    </th>
                    <th class="text-center" scope="col" sortable="availabilityDetails" (sort)="OnSort($event)">
                      Availability
                    </th>
                    <th class="text-center sm-col" scope="col" sortable="distanceFromAssessment" (sort)="OnSort($event)">
                      Distance (miles)
                    </th>
                    <th class="text-center" scope="col">
                      Select
                    </th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let availableDoctor of availableDoctors">
                    <td>
                      {{availableDoctor.doctorName}}
                    </td>
                    <td>
                      {{availableDoctor.doctorGender}}
                    </td>
                    <td>
                      {{availableDoctor.doctorType}}
                    </td>
                    <td>
                      {{availableDoctor.doctorSpeciality}}
                    </td>
                    <td class="text-center sm-col">
                      <i
                        class="fas fa-calendar-check scheduled"
                        *ngIf="availableDoctor.otherAssessmentDetails"
                        ngbTooltip={{availableDoctor.otherAssessmentDetails}}
                        placement="right"
                        tooltipClass="subtle-tooltip"
                        [closeDelay]="500" [openDelay]="500"
                        ></i>
                    </td>
                    <td class="text-center">
                      {{availableDoctor.availabilityDetails}}
                    </td>
                    <td class="text-center sm-col">
                      {{availableDoctor.distanceFromAssessment}}
                    </td>
                    <td class="checkmark-content text-center sm-col" style="position: relative">

                            <label class="container">
                              <input
                                class=""
                                type="checkbox"
                                value=""
                                (change)="TogglePlannedAssessment($event)"
                              />
                              <span class="checkmark"></span>
                            </label>

                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>


<ng-template #loading>
  <app-delay-spinner [delayMessage]="'Retrieving assessment data'"></app-delay-spinner>
</ng-template>


<app-toasts aria-live="polite" aria-atomic="true"></app-toasts>
